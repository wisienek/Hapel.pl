var npc,nrole,API=Java.type("noppes.npcs.api.NpcAPI").Instance();function init(e){npc=e.npc,nrole=e.npc.getRole()}function interact(e){var t=e.player.getMainhandItem();if(0!=t.getLore().length){var a=e.npc.getStoreddata(),r=a.get("owner"),o=JSON.parse(a.get("admins"))||{};return"variedcommodities:blueprint"==t.getName()&&t.getDisplayName().indexOf("NPC edit")>-1&&(r&&r.indexOf(e.player.getName())>-1||r.indexOf(e.player.getUUID())>-1)||Object.keys(o).indexOf(e.player.getUUID())>-1?(e.setCanceled(!0),e.player.message("[§cEditor§f] §7Wejście w tryb edycji npc"),gui1(e.player)):void 0}}function role(e){if(1==e.npc.getRole().getType()){if(!e.sold)return;if(e.sold.getStackSize()>0){if(void 0!==e.receiving)return;var t=e.npc.world.getBlock(e.npc.getBlockX(),e.npc.getBlockY(),e.npc.getBlockZ()),a=e.npc.getStoreddata().get("webhook");if(!getsold(e.sold,t,e,0)){if(e.setCanceled(!0),a){o="NPC: **"+e.npc.getName()+"** Nie ma towaru: **"+e.sold.getDisplayName().replace(/§./g,"").replace(/\&./g,"")+"** ("+e.sold.getStackSize()+")";o=ang(o),HTTP.post(a,{content:o,tts:!1})}return}var r="";if(e.currency1&&(lookforitems(e.currency1,t,e,0),r+=e.currency1.getStackSize()+"x "+e.currency1.getDisplayName(),getCurr(e,e.currency1)),e.currency2&&(lookforitems(e.currency2,t,e,0),r.length>0&&(r+=" "),r+=e.currency2.getStackSize()+"x "+e.currency2.getDisplayName(),getCurr(e,e.currency2)),a){var o="**"+e.player.getDisplayName()+"** kupil "+e.sold.getStackSize()+"x "+e.sold.getDisplayName().replace(/§./g,"").replace(/\&./g,"")+" za "+r.replace(/§./g,"").replace(/\&./g,"");o=ang(o),HTTP.post(a,{content:o,tts:!1})}executeCommand("traderlog "+e.player.getDisplayName()+" kupil "+e.sold.getStackSize()+"x "+e.sold.getDisplayName()+" za "+r)}}}function getsold(e,t,a,r){if(4==r&&e.getStackSize()>0)return a.npc.say("Sprzedawca nie ma towaru: "+e.getDisplayName()+", "+e.getStackSize()),!1;if(!t.isContainer()&&4!=r)return getsold(e,t=a.npc.world.getBlock(t.getX(),t.getY()-1,t.getZ()),a,r+1);if(t.isContainer()&&"minecraft:chest"==t.getName()){for(var o=t.getContainer(),i=o.getSize(),n=0;n<i;){var s=o.getSlot(n);if(e.getDisplayName()==s.getDisplayName()&&s.getStackSize()>=e.getStackSize()){if(s.getStackSize()-e.getStackSize()>=0)return s.setStackSize(s.getStackSize()-e.getStackSize()),!0;if(s.getStackSize()-e.getStackSize()<0)return e.setStackSize(e.getStackSize()-s.getStackSize()),s.setStackSize(0),getsold(e,o,a,r)}n++}if(n==i)return getsold(e,t=a.npc.world.getBlock(t.getX(),t.getY()-1,t.getZ()),a,r+1)}}function lookforitems(e,t,a,r){if(4==r)return a.npc.say("Nie trafiło do skrzyni: "+e.getDisplayName()+" ("+e.getStackSize()+")"),a.npc.say("Nie znaleziono skrzyni pod npc w ilości 3 kratek");if(!t||"minecraft:chest"!=t.getName())return lookforitems(e,t=a.npc.world.getBlock(t.getX(),t.getY()-1,t.getZ()),a,r+1);if("minecraft:chest"==t.getName()){for(var o=t.getContainer(),i=o.getSize(),n=e.getMaxStackSize(),s=0;s<i;){var l=o.getSlot(s);if(l.isEmpty()){o.setSlot(s,e);break}if(e.getDisplayName()==l.getDisplayName()&&l.getStackSize()<=n){if(l.getStackSize()+e.getStackSize()<=n){l.setStackSize(l.getStackSize()+e.getStackSize());break}if(l.getStackSize()!=n&&l.getStackSize()+e.getStackSize()>n){e.setStackSize(e.getStackSize()-n+l.getStackSize()),l.setStackSize(n),lookforitems(e,t,a,r);break}}s++}return s==i?lookforitems(e,t=a.npc.world.getBlock(t.getX(),t.getY()-1,t.getZ()),a,r+1):void 0}}function getCurr(e,t){var a,r=t.getDisplayName();if((a=r.indexOf("Knut")>-1?1:r.indexOf("Sykl")?21:r.indexOf("Galeon")?365:0)>0){var o=e.npc.world.getStoreddata(),i=e.npc.world.getStoreddata().get("VatVal"),n=o.get("MMVat");n+=a*t.getStackSize()*i,o.put("MMVat",n);var s=e.npc.world.getPlayer("Przesladowca");s&&s.message("[§cPodatnik§f] §7Pobrano vat z: §e"+a*t.getStackSize()+"§7k ("+t.getStackSize()*i+"), aktualny stan: §e"+n.toFixed(2)+"§7k")}}function executeCommand(e){return API.createNPC(API.getIWorld(0).getMCWorld()).executeCommand(e)}function baseGui(e,t){var a,r=API.createCustomGui(1,256,256,!1),o=npc.getStoreddata(),i=o.get("owner"),n=JSON.parse(o.get("admins"))||{};return"trader"==t?(r.addLabel(2,"§eEdytor NPC §7--\x3e",85,5,80,15),r.setBackgroundTexture("customnpcs:textures/gui/tradersetup1.png"),a=r.addLabel(545,"",240,5,20,20).setHoverText(["§c§l♚ §7- Właściciel","§c§l★ §7- Administrator","§c§l☢ §7- Inny"])):"tradere"==t?(r.addLabel(2,"§eEdytor NPC §7--\x3e",85,25,80,15),r.setBackgroundTexture("customnpcs:textures/gui/inve.png"),a=r.addLabel(545,"",225,20,20,20).setHoverText(["§c§l♚ §7- Właściciel","§c§l★ §7- Administrator","§c§l☢ §7- Inny"])):(r.addLabel(2,"§eEdytor NPC §7--\x3e",85,40,80,15),r.setBackgroundTexture("customnpcs:textures/gui/stdbg.png"),a=r.addLabel(545,"",240,35,20,20).setHoverText(["§c§l♚ §7- Właściciel","§c§l★ §7- Administrator","§c§l☢ §7- Inny"])),a&&(e.getName()==i?a.setText("§c♚"):n[e.getUUID()]?a.setText("§c★"):a.setText("§c☢")),r}function gui1(e){var t=baseGui(e);return t.addLabel(12,"§cGłówna strona",135,40,80,15),t.addButton(3,"§2Zmień wygląd",90,80,80,20),t.addButton(4,"§3Edycja sklepu",90,110,80,20),t.addButton(5,"§5Zmiana funkcjonalności",90,140,80,20),e.showCustomGui(t),t}function gui2(e){var t=baseGui(e);t.addLabel(9,"§cWygląd",140,40,80,15);var a=npc.getDisplay(),r=a.getName();t.addLabel(10,"§9Nazwa",65,80,25,15).setHoverText(["§4Uwaga!","§7Aby dodać kolor do nazwy","§7Poprzedź tekst znakiem §l&§r§7 i kodem koloru (patrz niżej)","§e&eZłoty król"]),t.addTextField(11,90,80,80,15).setText(r);var o=a.getSkinUrl().split("/").pop();t.addLabel(12,"§9Skin",70,100,15,15).setHoverText(["§4Uwaga!","§7Skin musi być zapisany na platformie imgur","§7Wpisz tylko końcówkę linku zaznaczoną zielonym kolorem poniżej","§chttps://i.imgur.com/§aDEiZteW.png"]),t.addTextField(13,90,100,80,15).setText(o);var i=a.getSize();return t.addButton(8,"§6Zmień rozmiar: "+i,90,120,80,20),t.addButton(901,"§c✖",105,195,20,20),t.addButton(200,"§a✍",135,195,20,20),e.showCustomGui(t),t}function gui3(e){var t=baseGui(e,"trader");t.addLabel(9,"§cSklep",140,5,80,15),t.showPlayerInventory(8,120);for(var a=1;a<=6;a++)t.addItemSlot(-23,21*(a-1)-12,nrole.getCurrency1(a-1));for(a=11;a<=16;a++)t.addItemSlot(-3,21*(a-11)-12,nrole.getCurrency2(a-11));for(a=21;a<=26;a++)t.addItemSlot(24,21*(a-21)-12,nrole.getSold(a-21));for(a=101;a<=106;a++)t.addItemSlot(58,21*(a-101)-12,nrole.getCurrency1(a-95));for(a=111;a<=116;a++)t.addItemSlot(78,21*(a-111)-12,nrole.getCurrency2(a-105));for(a=121;a<=126;a++)t.addItemSlot(105,21*(a-121)-12,nrole.getSold(a-115));for(a=201;a<=206;a++)t.addItemSlot(139,21*(a-201)-12,nrole.getCurrency1(a-189));for(a=211;a<=216;a++)t.addItemSlot(159,21*(a-211)-12,nrole.getCurrency2(a-199));for(a=221;a<=226;a++)t.addItemSlot(186,21*(a-221)-12,nrole.getSold(a-209));return t.addButton(901,"§c✖",225,205,20,20),e.showCustomGui(t),t}function gui4(e){var t=baseGui(e,"tradere");return t.addLabel(9,"§cFunkcjonalność",140,25,80,15),t.addTextField(11,50,65,140,20).setHoverText(["§7Wklej tutaj cały webhook z discorda"]),t.addButton(201,"§a✍",200,65,20,20).setHoverText(["§7Zapisz webhook"]),t.addButton(7,"§bDodaj admina",50,100,80,20),t.addButton(17,"§cUsuń admina",140,100,80,20),t.addButton(1,"§dSkrystalizuj NPC",95,125,80,20),t.addButton(901,"§c✖",213,185,20,20),t.showPlayerInventory(8,113),e.showCustomGui(t),t}function gui5(e,t,a){var r=baseGui(e);r.addLabel(9,"§cWspółwłaściciel",140,40,80,15);var o=[];if(t)for(var i=npc.getStoreddata(),n=JSON.parse(i.get("admins"))||{},s=Object.keys(n),l=0;l<s.length;l++)a&&n[s[l]].toLowerCase().indexOf(a.toLowerCase())>-1?o.push(n[s[l]]+" / "+s[l]):a||o.push(n[s[l]]+" / "+s[l]);else{var c=e.world.getAllPlayers();for(l=0;l<c.length;l++)a&&c[l].getName().toLowerCase().indexOf(a.toLowerCase())>-1?o.push(c[l].getName()):a||o.push(c[l].getName())}r.addScroll(t?17:11,10,65,120,150,o);var d=(i=npc.getStoreddata()).get("owner"),g=(n=JSON.parse(i.get("admins"))||{},s=Object.keys(n),["§c♚ §7"+d]);for(l=0;l<s.length;l++)g.push("§c★ §7"+n[s[l]]);return r.addLabel(20,"§2[Info o adminach]",160,135,80,20).setHoverText(g),r.addLabel(19,"§4§l[?]",10,40,15,15).setHoverText(["§7Kliknij §edwukrotnie§7 na osobę z listy","§7Aby dodać/usunąć ją jako współwłaściciela","§7Współwłaściciel ma §eTakie same §7prawa co właściciel"]),r.addTextField(12,140,80,100,20),r.addButton(t?14:13,"§eSzukaj po nazwie",150,105,80,20),e.showCustomGui(r),r}function customGuiScroll(e){switch(e.scrollId){case 11:if(!e.doubleClick)return;var t=e.selection[0],a=e.player.world.getPlayer(t);if(!a)return e.player.message("[§cNPC§f] §7Nie znaleziono gracza!");var r=npc.getStoreddata();return(i=JSON.parse(r.get("admins"))||{})[a.getUUID()]=t,r.put("admins",JSON.stringify(i)),e.player.message("[§cNPC§f] §7Dodano gracza §b"+t+"§7 jako współwłaściciela!"),gui5(e.player);case 17:if(!e.doubleClick)return;t=e.selection[0];var o=npc.getStoreddata(),i=JSON.parse(o.get("admins"))||{},n=Object.keys(i),s=t.split("/ ")[1];return-1==n.indexOf(s)?e.player.message("[§cNPC§f] §7Nie ma takiego admina!"):(delete i[s],o.put("admins",JSON.stringify(i)),e.player.message("[§cNPC§f] §7Usunięto gracza §b"+t+"§7 ze współwłaścicieli!"),gui5(e.player,!0))}}function customGuiButton(e){switch(e.buttonId){case 1:var t=e.player.world.createItem("variedcommodities:gem_ruby",0,1);return t.setCustomName("§cSkrystalizowany sprzedawca"),t.setLore(["§7Tajemniczy kryształ trzyma w sobie","§7Duszę androida sprzedawcy!",npc.getName(),"§8Kliknij Prawym przyciskiem myszy aby ją uwolnić"]),npc.storeAsClone(7,npc.getName()),e.player.giveItem(t),e.player.message("[§cNPC§f] §7Skrystalizowano sprzedawcę!"),npc.despawn(),void e.player.closeGui();case 3:return gui2(e.player);case 4:return gui3(e.player);case 5:return gui4(e.player);case 7:return gui5(e.player);case 8:var a=e.gui.getComponent(8).getLabel().split(": ")[1];return!(a=parseInt(a))||isNaN(a)||a<=0||a>7?e.player.message("[§cNPC§f] §7Rozmiar musi być z zakresu <1;7>"):(npc||e.player.message("nie ma npc"),7==a?a=1:a++,npc.getDisplay().setSize(a),e.gui.getComponent(8).setLabel("§6Zmień rozmiar: "+a),e.player.message("[§cNPC§f] §7Zmieniono rozmiar na §b"+a),e.player.showCustomGui(e.gui));case 13:return(n=e.gui.getComponent(12).getText())?gui5(e.player,!1,n):e.player.message("[§cNPC§f] §7Nie ma tekstu w polu!");case 14:return(n=e.gui.getComponent(12).getText())?gui5(e.player,!0,n):e.player.message("[§cNPC§f] §7Nie ma tekstu w polu!");case 17:return gui5(e.player,!0);case 200:var r=e.gui.getComponent(11).getText(),o=e.gui.getComponent(13).getText(),i=npc.getDisplay();return r&&r!=i.getName()&&(r=r.replace(/&/g,"§"),i.setName(r),e.player.message("[§cNPC§f] §7Zmieniono nazwę na §b"+r)),o&&o!=i.getSkinUrl().split("/").pop()&&(i.setSkinUrl("https://i.imgur.com/"+o),e.player.message("[§cNPC§f] §7Zmieniono skin na §bhttps://i.imgur.com/"+o)),gui2(e.player);case 201:var n;return(n=e.gui.getComponent(11).getText())?-1==n.indexOf("discord")||-1==n.indexOf("api")||-1==n.indexOf("webhook")?e.player.message("[§cNPC§f] §7Niepoprawny webhook!"):(npc.getStoreddata().put("webhook",n),e.player.message("[§cNPC§f] §7Zmieniono webhook na: §e"+n)):(npc.getStoreddata().remove("webhook"),e.player.message("[§cNPC§f] §7Resetowano webhook!"));case 901:return gui1(e.player)}}function customGuiSlot(e){var t,a,r,o;e.slotId>=0&&e.slotId<=5||e.slotId>=18&&e.slotId<=23||e.slotId>=36&&e.slotId<=41?t=e.stack:e.slotId>=6&&e.slotId<=11||e.slotId>=24&&e.slotId<=29||e.slotId>=42&&e.slotId<=47?a=e.stack:(e.slotId>=12&&e.slotId<=17||e.slotId>=30&&e.slotId<=35||e.slotId>=48&&e.slotId<=53)&&(r=e.stack),e.slotId>=0&&e.slotId<=5?o=e.slotId:e.slotId>=6&&e.slotId<=11?o=e.slotId-6:e.slotId>=12&&e.slotId<=17?o=e.slotId-12:e.slotId>=18&&e.slotId<=23?o=e.slotId-12:e.slotId>=24&&e.slotId<=29?o=e.slotId-18:e.slotId>=30&&e.slotId<=35?o=e.slotId-24:e.slotId>=36&&e.slotId<=41?o=e.slotId-24:e.slotId>=42&&e.slotId<=47?o=e.slotId-30:e.slotId>=48&&e.slotId<=53&&(o=e.slotId-36),t?nrole.set(o,t,nrole.getCurrency2(o),nrole.getSold(o)):a?nrole.set(o,nrole.getCurrency1(o),a,nrole.getSold(o)):r&&nrole.set(o,nrole.getCurrency1(o),nrole.getCurrency2(o),r)}